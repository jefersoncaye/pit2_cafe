<html>
<head>
    {% load static %}
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="generator" content="Mobirise v5.9.13, a.mobirise.com">
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1">
    <link rel="shortcut icon" href="{% static 'images/photo-1527964275784-5ce8ddab3d8e.jpeg' %}" type="image/x-icon">
    <meta name="description"
          content="Descubra a excelência do café premium com nossa seleção exclusiva. Cadastre-se, explore nossos produtos e faça seu pedido facilmente.">
    <title>Café Premium Online</title>
    <link rel="stylesheet" href="{% static 'bootstrap/css/bootstrap.min_rnd_1724544614987.css' %}">
    <link rel="stylesheet" href="{% static 'bootstrap/css/bootstrap-grid.min_rnd_1724544614987.css' %}">
    <link rel="stylesheet" href="{% static 'bootstrap/css/bootstrap-reboot.min_rnd_1724544614987.css' %}">
    <link rel="stylesheet" href="{% static 'parallax/jarallax_rnd_1724544614987.css' %}">
    <link rel="stylesheet" href="{% static 'dropdown/css/style_rnd_1724544614987.css' %}">
    <link rel="stylesheet" href="{% static 'theme/css/style_rnd_1724544614987.css' %}">
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Golos+Text:wght@400;700&display=swap" as="style"
          onload="this.onload=null;this.rel='stylesheet'">
    <noscript>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Golos+Text:wght@400;700&display=swap">
    </noscript>
    <link rel="stylesheet" href="{% static 'css/mbr-additional_rnd_1724544614987.css' %}" type="text/css">
    <style>
        html {
            scroll-behavior: smooth;
        }
        .alert {
            margin-top: 10px;
        }
    </style>
</head>
<body>
<section data-bs-version="5.1" class="menu menu2 cid-umpSBbxcAw" once="menu" id="menu-5-umpSBbxcAw">
    <nav class="navbar navbar-dropdown navbar-fixed-top navbar-expand-lg">
        <div class="container">
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-bs-toggle="collapse"
                    data-target="#navbarSupportedContent" data-bs-target="#navbarSupportedContent"
                    aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
                <div class="hamburger">
                    <span></span>
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            </button>
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav nav-dropdown w-100 d-flex justify-content-between align-items-center"
                    data-app-modern-menu="true">
                    <!-- Itens à esquerda: Home e Olá, Usuário -->
                    <div class="d-flex">
                        <li class="nav-item">
                            <a href="{% url 'home' %}" class="btn btn-primary mx-2">Home</a>
                        </li>

                        {% if user.is_authenticated %}
                        <li class="nav-item">
                            <span class="nav-link link text-black display-4">Olá, {{ user.username }}!</span>
                        </li>
                        {% else %}
                        <!-- Botões Cadastrar e Entrar -->
                        <li class="nav-item">
                            <a href="{% url 'clientes' %}" class="btn btn-primary mx-2">Cadastrar</a>
                        </li>
                        <li class="nav-item">
                            <a href="{% url 'login' %}" class="btn btn-primary mx-2">Entrar</a>
                        </li>
                        {% endif %}
                    </div>

                    <!-- Itens centralizados: Produtos, Carrinho e Pedidos -->
                    <div class="d-flex justify-content-center mx-auto">
                        <li class="nav-item">
                            <a href="{% url 'home' %}" class="nav-link link text-black display-4">Produtos</a>
                        </li>
                        <li class="nav-item">
                            <a href="{% url 'carrinho' %}" class="nav-link link text-black display-4">Carrinho</a>
                        </li>
                        <li class="nav-item">
                            <a href="{% url 'pedidos' %}" class="nav-link link text-black display-4">Pedidos</a>
                        </li>
                    </div>

                    <!-- Botão de Sair à direita -->
                    <div class="d-flex ml-auto">
                        {% if user.is_authenticated %}
                        <li class="nav-item">
                            <form method="POST" action="{% url 'logout' %}" style="display: inline;">
                                {% csrf_token %}
                                <button type="submit" class="nav-link link text-black display-4">Sair</button>
                            </form>
                        </li>
                        {% endif %}
                    </div>
                </ul>
            </div>
        </div>
    </nav>
</section>

<div class="mbr-overlay" style="opacity: 0.5; background-color: rgb(0, 0, 0);"></div>
<div class="container-fluid">
    <div class="row">
        <div class="content-wrap col-12 col-md-12">
            <h1 class="mbr-section-title mbr-fonts-style mbr-white mb-4 display-1">
                <br><br>
                <strong>Café Premium</strong>
            </h1>
            <p class="mbr-fonts-style mbr-text mbr-white mb-4 display-7">Descubra o sabor que vai fazer seu coração
                acelerar!</p>
        </div>
    </div>
</div>

<section data-bs-version="5.1" class="pricing02 cid-umpSBbzytp" id="lista_produtos">
    <div class="container-fluid">
        <div class="row justify-content-center">
            <div class="col-12 content-head">
                <div class="mbr-section-head mb-5">
                    <h4 class="mbr-section-title mbr-fonts-style align-center mb-0 display-2">
                        <strong>Nossos Cafés Premium</strong>
                    </h4>
                </div>
            </div>
        </div>
        <div class="row">
            {% for produto in produtos %}
            <div class="item features-image col-12 col-md-6 col-lg-4">
                <div class="item-wrapper">
                    <div class="item-img">
                        <img src="{{ produto.imagem.url }}">
                    </div>
                    <div class="item-content">
                        <h5 class="item-title mbr-fonts-style display-5">
                            <strong>{{ produto.nome }}</strong>
                        </h5>
                        <h6 class="item-subtitle mbr-fonts-style display-7">R$ {{ produto.preco }}</h6>
                        <p class="mbr-text mbr-fonts-style display-7">{{ produto.descricao }}</p>
                        <form id="form-carrinho-{{ produto.id }}" method="POST">
                            {% csrf_token %}
                            <input type="hidden" name="produto_id" value="{{ produto.id }}">
                            <input type="hidden" name="preco" value="{{ produto.preco }}">
                            <label for="quantidade_{{ produto.id }}">Quantidade:</label>
                            <input type="number" id="quantidade_{{ produto.id }}" name="quantidade" min="1" value="1"
                                   class="form-control mb-2" style="width: 120px;">
                            <button type="submit" class="btn item-btn btn-primary display-7">Adicionar ao Carrinho
                            </button>
                        </form>
                        <div id="message-{{ produto.id }}" class="mt-2"></div> <!-- Local para a mensagem -->
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</section>

<div class="container">
    <div class="row">
        <div class="col-12 col-lg-6 center mt-2 mb-3">
            <p class="mbr-fonts-style copyright mb-0 display-7">&#169; 2024 Café Premium. Todos os direitos
                reservados.</p>
        </div>
    </div>
</div>

<script src="{% static 'web/assets/jquery/jquery.min_rnd_1724544614987.js' %}"></script>
<script src="{% static 'bootstrap/js/bootstrap.bundle.min_rnd_1724544614987.js' %}"></script>
<script src="{% static 'parallax/jarallax_rnd_1724544614987.js' %}"></script>
<script src="{% static 'smoothscroll/smooth-scroll_rnd_1724544614987.js' %}"></script>
<script src="{% static 'dropdown/js/navbar-dropdown_rnd_1724544614987.js' %}"></script>
<script>
    document.querySelectorAll('form[id^="form-carrinho-"]').forEach(form => {
        form.addEventListener('submit', function(event) {
            event.preventDefault();  // Evita o envio normal do formulário

            const formId = this.id;
            const produtoId = formId.split('-').pop();
            const messageDiv = document.querySelector(`#message-${produtoId}`);
            const formData = new FormData(this);

            fetch('{% url "adicionar_ao_carrinho" %}', {
                method: 'POST',
                body: formData,
                headers: {
                    'X-Requested-With': 'XMLHttpRequest',
                    'X-CSRFToken': formData.get('csrfmiddlewaretoken')
                }
            })
            .then(response => response.json())
            .then(data => {
                // Atualize a mensagem de status na página
                if (data.status === 'success') {
                    messageDiv.innerHTML = `<div class="alert alert-success" role="alert">${data.message}</div>`;
                } else {
                    messageDiv.innerHTML = `<div class="alert alert-danger" role="alert">${data.message}</div>`;
                }

                // Remova a mensagem após 3 segundos
                setTimeout(() => {
                    messageDiv.innerHTML = '';
                }, 3000);
            })
            .catch(error => {
                console.error('Erro:', error);
                messageDiv.innerHTML = `<div class="alert alert-danger" role="alert">Erro ao adicionar item ao carrinho.</div>`;

                // Remova a mensagem após 3 segundos
                setTimeout(() => {
                    messageDiv.innerHTML = '';
                }, 3000);
            });
        });
    });
</script>
</body>
</html>
